!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).emcenter=e()}(this,(function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function e(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,i(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=o(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function r(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||o(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function o(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}var a=function(){return e((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._listeners=[],this._isSilent=!1,this._isScoped=!1}),[{key:"on",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return Array.isArray(t)?(t.forEach((function(t){return n.on(t,e,r)})),this):(this._listeners.push({event:t,callback:e,priority:r}),u(this._listeners),this)}},{key:"once",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return Array.isArray(t)?(t.forEach((function(t){return n.once(t,e,r)})),this):(this._listeners.push({event:t,callback:e,priority:r,once:!0}),u(this._listeners),this)}},{key:"off",value:function(t,e){var n=this;return Array.isArray(t)?(t.forEach((function(t){return n.off(t,e)})),this):(this._listeners=this._listeners.filter((function(n){return n.event!==t||void 0!==e&&n.callback!==e})),this)}},{key:"contain",value:function(t,e){var n=this;return Array.isArray(t)?t.every((function(t){return n.contain(t,e)})):this._listeners.some((function(n){return n.event===t&&(void 0===e||n.callback===e)}))}},{key:"silent",value:function(t){if("boolean"!=typeof t){if(!Array.isArray(t)){this._isSilent=!0;var e=t.call(this);return this._isSilent=!1,e}this._isSilent=t}else this._isSilent=t}},{key:"scope",value:function(t){if("boolean"!=typeof t){this._isScoped=!0;var e=t.call(this);return this._isScoped=!1,e}this._isScoped=t}},{key:"emit",value:function(t,e){for(var i=this,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];if(!this._isSilent&&("boolean"!=typeof t&&(a.unshift(e),e=t,t=!1),!Array.isArray(this._isSilent)||!this._isSilent.includes(e))){var u,l=this._listeners.filter((function(t){return t.event===e})),f=this._isScoped,v=f?[]:this._listeners.filter((function(t){return e.startsWith(t.event+".")})),y=t&&!f?this._listeners.filter((function(t){return t.event.startsWith(e+".")})):[],h=f?[]:this._listeners.filter((function(t){return"*"===t.event})),p=!1,b=!1,d=!1,m=function(){p=!0},_=function(){b=!0},k=function(){d=!0},S=function(n){var r={target:e,event:n.event,priority:n.priority,callback:n.callback,broadcast:t,preventDefault:m,stopPropagation:_,stopImmediatePropagation:k,stack:s()};n.once&&i.off(n.event,n.callback),n.callback.apply(n,[r].concat(a))},g=n(l);try{for(g.s();!(u=g.n()).done;){var A=u.value;if(p||d)break;S(A)}}catch(t){g.e(t)}finally{g.f()}for(var w=0,P=[].concat(r(y),r(v));w<P.length;w++){var j=P[w];if(b||d)break;S(j)}var E,I=n(h);try{for(I.s();!(E=I.n()).done;){var T=E.value;if(d)break;S(T)}}catch(t){I.e(t)}finally{I.f()}}}},{key:"dispatch",value:function(t,e){for(var n=this,i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return new Promise((function(i,a){if(n._isSilent||Array.isArray(n._isSilent)&&n._isSilent.includes(e))return i();if("boolean"!=typeof t){var u=[t,!1];e=u[0],t=u[1]}var l=n._listeners.filter((function(t){return t.event===e})),f=n._isScoped,v=f?[]:n._listeners.filter((function(t){return e.startsWith(t.event+".")})),y=t&&!f?n._listeners.filter((function(t){return t.event.startsWith(e+".")})):[],h=f?[]:n._listeners.filter((function(t){return"*"===t.event})),p=!1,b=!1,d=function(){p=!0},m=function(){},_=function(){b=!0},k=function(r){var i=0,u=function(){return p||b||i===r.length?Promise.resolve():function(r){var i={target:e,event:r.event,priority:r.priority,callback:r.callback,broadcast:t,preventDefault:d,stopPropagation:m,stopImmediatePropagation:_,stack:s()},a=c(r.callback);return r.once&&n.off(r.event,r.callback),a.apply(void 0,[i].concat(o))}(r[i++]).then(u).catch(a)};return u()};k(l).then((function(){return k([].concat(r(y),r(v)))})).then((function(){return k(h)})).then(i).catch(a)}))}},{key:"distribute",value:function(t,e){for(var n=this,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return new Promise((function(r,o){if(n._isSilent||Array.isArray(n._isSilent)&&n._isSilent.includes(e))return r();if("boolean"!=typeof t){var a=[t,!1];e=a[0],t=a[1]}var u=n._listeners.filter((function(t){return t.event===e})),l=n._isScoped,f=l?[]:n._listeners.filter((function(t){return e.startsWith(t.event+".")})),v=t&&!l?n._listeners.filter((function(t){return t.event.startsWith(e+".")})):[],y=l?[]:n._listeners.filter((function(t){return"*"===t.event})),h=!1,p=!1,b=function(){h=!0},d=function(){},m=function(){p=!0},_=function(r){return Promise.all(r.map((function(r){return h||p?Promise.resolve():function(r){var o={target:e,event:r.event,priority:r.priority,callback:r.callback,broadcast:t,preventDefault:b,stopPropagation:d,stopImmediatePropagation:m,stack:s()};return r.once&&n.off(r.event,r.callback),c(r.callback).apply(void 0,[o].concat(i))}(r)})))};_(u).then((function(){return _(f.concat(v))})).then((function(){return _(y)})).then(r).catch(o)}))}},{key:"destroy",value:function(){this._listeners.length=0}}])}();function s(){var t=new Error;return(t.stack||t.stacktrace).split("\n").slice(2).join("\n")}function c(t){return function(){try{return Promise.resolve(t.apply(void 0,arguments))}catch(t){return Promise.reject(t)}}}function u(t){t.sort((function(t,e){return t.priority>e.priority?-1:t.priority<e.priority?1:0}))}return a}));
